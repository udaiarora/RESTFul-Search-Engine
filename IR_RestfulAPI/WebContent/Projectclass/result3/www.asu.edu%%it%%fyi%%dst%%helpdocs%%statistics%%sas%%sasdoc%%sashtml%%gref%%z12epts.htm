<HTML>
<!-- This page produced Fri Jul  9 14:14:38 EDT 1999
 -->
<!-- Used program version 1.118.1.2 from beta -->
<HEAD>
<!-- <META http-equiv="Content-Type" content="text/html; charset="> -->
<TITLE>The G3GRID Procedure : Concepts </TITLE></HEAD>
<BODY bgcolor="#FFFFFF">
<!-- navigation -->
<TABLE cellpadding="0" cellspacing="0">
<TR valign="top">
<TD align="center">
<A href="zridchap.htm">
<IMG border="0" SRC="../common/images/cont1.gif"><BR><FONT size="-2">Chapter Contents</FONT></A></TD>
<TD align="center">
<A href="z16view.htm">
<IMG border="0" src="../common/images/prev1.gif"><BR><FONT size="-2">Previous</FONT></A></TD>
<TD align="center">
<A href="z16ntax.htm">
<IMG border="0" SRC="../common/images/next1.gif"><BR><FONT size="-2">Next</FONT></A></TD>
</TR></TABLE>
<!-- running head -->
<TABLE width="100%" cellpadding="4">
<TR valign="MIDDLE">
<TD bgcolor="#CCCC99"><I><FONT size="2">The G3GRID Procedure</FONT></I></TD>
</TR>
</TABLE><H1><FONT size="5"><A name="z12epts">Concepts</A></FONT></H1>


<P><TABLE width="100%" cellpadding="0" cellspacing="0">
<TR valign="bottom"><TD><HR></TD></TR>
<TR valign="top"><TD><B><FONT size="5"><A name="z1data">About the Input Data Set</A></FONT></B></TD></TR></TABLE>

<P><A name="z0692516">&#13;
 The input data set must contain at least three numeric variables:
</A>
<P>
<UL>

<LI>two horizontal variables, (<B>x</B>,  <B>y</B>)<P>

<LI>one or more vertical variables, <B>z</B>
through <B>z</B>-<B>n</B>, that will be interpolated or smoothed
as if it were a function of the two horizontal variables.<P>
</UL>

<P>The procedure can process multiple vertical variables
for each pair of horizontal variables that you specify. If you specify more
than one vertical variable, the G3GRID procedure performs a separate analysis
and produces interpolated or smoothed values for each vertical variable. If
more than one observation in the input data set has the same values for both
horizontal variables, <B>x</B> and <B>y</B>, a warning message
is printed, and only the first such point is used in the interpolation.
<P>By default, the interpolation is performed after both
variables are similarly scaled because the interpolation methods assume that
the scales of <B>x</B> and <B>y</B> are comparable.
<P><TABLE width="100%" cellpadding="0" cellspacing="0">
<TR valign="bottom"><TD><HR></TD></TR>
<TR valign="top"><TD><B><FONT size="5"><A name="z0281207">Multiple Vertical Variables</A></FONT></B></TD></TR></TABLE>

<P><A name="z0692521">&#13;
 In the GRID statement,
you can name multiple vertical variables (<B>z</B> through <B>z</B>-<B>n</B>) and produce a data set that contains two horizontal variables and
multiple vertical variables. You can use the resulting data set to produce
plots of the relationships of the two horizontal variables to different vertical
variables.</A>
<P><TABLE width="100%" cellpadding="0" cellspacing="0">
<TR valign="bottom"><TD><HR></TD></TR>
<TR valign="top"><TD><B><FONT size="5"><A name="z0281208">Horizontal Variables Along a Nonlinear Curve</A></FONT></B></TD></TR></TABLE>

<P><A name="z0692522">&#13; If the points that are generated by the horizontal variables
tend to lie along a curve, a poor interpolation or spline may result.  In
such cases, the vertical variable(s) and one of the horizontal variables should
be modeled as a function of the remaining horizontal variable. You can use
a scatter plot of the two horizontal variables to help determine the appropriate
function.</A>
<P>If the horizontal variable points are collinear, the
procedure interpolates the function as constant along lines perpendicular
to the line in the plane that is generated by the input data points.
<P><TABLE width="100%" cellpadding="0" cellspacing="0">
<TR valign="bottom"><TD><HR></TD></TR>
<TR valign="top"><TD><B><FONT size="5"><A name="z0281209">About the Output Data Set</A></FONT></B></TD></TR></TABLE>

<P><A name="z0692524">&#13;
 The output data set contains the two horizontal variables, the
interpolated or smoothed vertical variables, and the BY variables, if any.
 If the GRID statement's SMOOTH= option is used, the output data set also
contains a variable named _SMTH_, with a value equal to that of the smoothing
parameter.</A>
<P>You can control both the number of <B>x</B> and <B>y</B> values in the output data set and the values themselves.  In addition,
you can specify an interpolation method.
<P><TABLE width="100%" cellpadding="0" cellspacing="0">
<TR valign="bottom"><TD><HR></TD></TR>
<TR valign="top"><TD><B><FONT size="5"><A name="z0281210">Interpolation Methods</A></FONT></B></TD></TR></TABLE>

<P><A name="z0692526">&#13; The G3GRID procedure can use
one of three interpolation methods:
bivariate interpolation (the default), spline interpolation, and smoothed
spline interpolation.</A>
<BR><H3><A name="z0281211">Default Bivariate Interpolation</A></H3>


<P><A name="z0692527">&#13;
  Unless you specify the
SPLINE option, the G3GRID procedure is an interpolation procedure.  That is,
it calculates <B>z</B> values for <B>x</B>, <B>y</B> points
that are missing from the input grid.  The surface that is formed by the interpolated
data passes precisely through the data points in the input data set.</A>
<P>This default method of interpolation works best for
fairly smooth functions with values given at uniformly distributed points
in the plane. If the data points in the input data set are erratic, the default
interpolated surface can be erratic.
<P>This default method is a modification of that described
by Akima (1978).  This method consists of 
<OL START="1" type="1">
<LI>dividing the plane into nonoverlapping triangles
that use the positions of the available points<P>

<LI>fitting a bivariate fifth degree polynomial within
each triangle<P>

<LI>calculating the interpolated values by evaluating
the polynomial at each grid point that falls in the triangle.<P>
</OL>

<P>The coefficients for the polynomial are computed based
on 
<P>
<UL>

<LI>the values of the function at the vertices of
the triangle<P>

<LI>the estimated values for the first and second
derivatives of the function at the vertices.<P>
</UL>

<P>The estimates of the first and second derivatives are
computed using the <B>n</B> nearest neighbors of the point, where <B>n</B> is the number specified in the GRID statement's NEAR= option.  A
Delauney triangulation (Ripley 1981, p. 38) is used for the default method.
 The coordinates of the triangles are available in an output data set if requested
by the OUTTRI= option in the PROC G3GRID statement.
<BR><H3><A name="z2rpol">Spline Interpolation</A></H3>


<P><A name="z0692537">&#13;
 
   If you specify the SPLINE option, a method
is used that produces an interpolation or smoothing that is optimally smooth
in a certain sense (Harder and Desmarais 1972, Meinguet 1979).  The surface
that is generated can be thought of as one that would be formed if a stiff,
thin metal plate were forced through or near the given data points.  For large
data sets, this method is substantially more expensive than the default method.</A>
<P>The function <B>u</B>, formed when you specify
the SPLINE option, is determined by letting
<P>
<P><IMG border="0" src="./images/deqn6.gif" vspace="12" alt="[IMAGE]">
<P>


<P>
<P><IMG border="0" src="./images/deqn7.gif" vspace="12" alt="[IMAGE]">
<P>

 
<P>and 
<P>
<P><IMG border="0" src="./images/deqn8.gif" vspace="12" alt="[IMAGE]">
<P>


<P>
<P><IMG border="0" src="./images/deqn9.gif" vspace="12" alt="[IMAGE]">
<P>
<P>where
<P>
<P><IMG border="0" src="./images/deqn10.gif" vspace="12" alt="[IMAGE]">
<P>
<P>The coefficients <B>c</B><SUB>1</SUB>, <B>c</B><SUB>2</SUB>,..., <B>c<SUB>n</SUB></B>
and <B>d</B><SUB>1</SUB>, <B>d</B><SUB>2</SUB>, <B>d</B><SUB>3</SUB> of this polynomial are determined by these
equations:
<P>
<P><IMG border="0" src="./images/deqn11.gif" vspace="12" alt="[IMAGE]">
<P>
<P>and 
<P>
<P><IMG border="0" src="./images/deqn12.gif" vspace="12" alt="[IMAGE]">
<P>
<P>where 
<DL>
<DT><B>E</B></DT>
<DD>is the <B>n</B> &times; <B>n</B>
matrix E(<B>t<SUB>i</SUB></B> , <B>t<SUB>j</SUB></B>
)<P></DD>

<DT><B>I</B></DT>
<DD>is the <B>n</B> &times; <B>n</B>
identity matrix<P></DD>

<DT><IMG border="0" src="../common/images/lambdal.gif" alt="[lambda]"></DT>
<DD>is the smoothing parameter that is specified
in the SMOOTH= option<P></DD>

<DT><B>c</B></DT>
<DD>is (<B>c</B><SUB>1</SUB>
,..., <B>c<SUB>n</SUB></B> )<P></DD>

<DT><B>z</B></DT>
<DD>is (<B>z</B><SUB>1</SUB>
,..., <B>z<SUB>n</SUB></B> )<P></DD>

<DT><B>d</B></DT>
<DD>is (<B>d</B><SUB>1</SUB>, <B>d</B><SUB>2</SUB>,
<B>d</B><SUB>3</SUB>)<P></DD>

<DT><B>T</B></DT>
<DD>is the <B>n</B> &times; 3 matrix whose <B>i</B>th row is (1, <B>x<SUB>i</SUB></B>, 
<B>y<SUB>i</SUB></B>).<P></DD>
</DL>

<P>See Wahba (1979) for more detail.
<BR><H3><A name="z0281212">Spline Smoothing</A></H3>


<P><A name="z0692559">&#13;
    To
produce a smoothed spline, you can use the GRID statement's
SMOOTH= option with the SPLINE option. The value or values specified in the
SMOOTH= option are substituted for <IMG border="0" src="../common/images/lambdal.gif" alt="[lambda]"> in the equation that is described
in </A><A href="#z2rpol">Spline Interpolation</A>.
A smoothed spline trades closeness to the original data points for smoothness.
To find a value that produces the best balance between smoothness and fit
to the original data, you can try several values for the SMOOTH= option.

<P><!-- navigation -->
<P><TABLE cellpadding="0" cellspacing="0">
<TR valign="top">
<TD align="center">
<A href="zridchap.htm">
<IMG border="0" SRC="../common/images/cont1.gif"><BR><FONT size="-2">Chapter Contents</FONT></A></TD>
<TD align="center">
<A href="z16view.htm">
<IMG border="0" src="../common/images/prev1.gif"><BR><FONT size="-2">Previous</FONT></A></TD>
<TD align="center">
<A href="z16ntax.htm">
<IMG border="0" SRC="../common/images/next1.gif"><BR><FONT size="-2">Next</FONT></A></TD>
<TD align="center">
<A href="#z12epts">
<IMG border="0" SRC="../common/images/top1.gif"><BR><FONT size="-2">Top of Page</FONT></A></TD>
</TR></TABLE>
<P><FONT size=1><A href="../common/images/copyrite.htm">Copyright 1999 by SAS Institute Inc., Cary, NC, USA. All rights reserved.</A></FONT>
</BODY>
</HTML>