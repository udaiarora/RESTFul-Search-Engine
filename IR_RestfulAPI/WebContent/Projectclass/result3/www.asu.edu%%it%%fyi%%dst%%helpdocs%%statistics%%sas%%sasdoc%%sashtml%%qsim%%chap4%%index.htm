<HTML>
<HEAD>
<TITLE>Formulas</TITLE>
<LINK REL="STYLESHEET" TYPE="text/css" HREF="../sas.css">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<!--Navigation Panel-->
<TABLE BORDER="0" CELLPADDING="0">
<TR VALIGN="TOP">
  <TD ALIGN="CENTER">
  <A NAME="topofpage" HREF="../index.htm">
  <IMG BORDER="0" SRC="../../common/images/cont1.gif" ALT="Book Contents" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Book Contents</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="../chap3/index.htm"><IMG BORDER="0" SRC="../../common/images/prev1.gif" ALT="Previous" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Previous</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="../chap5/index.htm"><IMG BORDER="0" SRC="../../common/images/next1.gif" ALT="Next" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Next</FONT></A></TD>
</TR>
</TABLE>
<TABLE BGCOLOR="#CCCC99" WIDTH="100%" CELLPADDING=4>
<TR>
  <TD VALIGN=MIDDLE CLASS="chaphead"><I><FONT SIZE="2">SAS/OR: The QSIM Application</FONT></I></TD>
</TR>
</TABLE><BR>
<P><!--End of Navigation Panel-->
<P><A NAME="formulas">&#13;</A><A NAME="chap:formulas">&#13;</A>
<H1><FONT SIZE="5">Formulas</FONT></H1>
<A NAME="idxqs40001">&#13;</A>The 
<A HREF="../chap2/sect10.htm#router">Router</A>, 
<A HREF="../chap2/sect9.htm#switch">Switch</A>, and 
<A HREF="../chap2/sect7.htm#modifier">Modifier</A> components
use formulas to control routing and set attributes.<A NAME="idxqs40002">&#13;</A><A NAME="idxqs40003">&#13;</A><A NAME="idxqs40004">&#13;</A><A NAME="idxqs40005">&#13;</A>Formulas are specified in a Formula Manager window.
<A NAME="idxqs40006">&#13;</A><A NAME="idxqs40007">&#13;</A><A HREF="index.htm#cpformul">Figure 6.6</A> shows one such window with the formula
<SPAN CLASS="mathfont">5.0 + <I>X</I></SPAN>, where <SPAN CLASS="mathfont"><I>X</I></SPAN> is a 
<A HREF="../chap6/index.htm#random">random variable</A> with distribution
<SPAN CLASS="mathfont"><I>E</I>(1)</SPAN>, exponentially distributed with mean 1.
<P><A NAME="cpformul">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/cpformul.gif" ALT="cpformul.gif (9751 bytes)" HEIGHT="422" WIDTH="490">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.1:</B> Formula Manager Window</SPAN><P>
<P>Formulas are built using an interface
that is similar to that used when building models.
The palette has a set of icons that can be dragged and
dropped into the Formula Manager window.<A NAME="idxqs40008">&#13;</A><A NAME="idxqs40009">&#13;</A>You use these to build expressions.
The following table shows some of the elements that are used to build expressions:
<P><DIV ALIGN="CENTER">
<TABLE COLS=2 BORDER=0><COL><COL>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP>Icon</TD><TD ALIGN=LEFT NOWRAP>Description</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formula.gif" ALT="formula.gif (990 bytes)" HEIGHT="26" WIDTH="28"></TD><TD ALIGN=LEFT NOWRAP>another formula</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formulat.gif" ALT="formulat.gif (955 bytes)" HEIGHT="26" WIDTH="27"></TD><TD ALIGN=LEFT NOWRAP>a transaction attribute</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formulac.gif" ALT="formulac.gif (1025 bytes)" HEIGHT="26" WIDTH="27"></TD><TD ALIGN=LEFT NOWRAP>the simulation clock</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formulm2.gif" ALT="formulm2.gif (988 bytes)" HEIGHT="26" WIDTH="27"></TD><TD ALIGN=LEFT NOWRAP>a component in the model</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formulad.gif" ALT="formulad.gif (999 bytes)" HEIGHT="27" WIDTH="28"></TD><TD ALIGN=LEFT NOWRAP>an observation of a variable in a SAS data set</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formulan.gif" ALT="formulan.gif (977 bytes)" HEIGHT="28" WIDTH="27"></TD><TD ALIGN=LEFT NOWRAP>a number constant</TD></TR>
<TR VALIGN="TOP"><TD ALIGN=LEFT NOWRAP><IMG SRC="images/formuls2.gif" ALT="formuls2.gif (968 bytes)" HEIGHT="26" WIDTH="27"></TD><TD ALIGN=LEFT NOWRAP>a string constant</TD></TR>
</TABLE></DIV>
<P>As with components, each of these elements has a pop-up menu associated with it.
For example, the random variable icon
<IMG SRC="images/formular.gif" ALT="formular.gif (952 bytes)" HEIGHT="26" WIDTH="26">shown in&#160;<A HREF="index.htm#cpformul">Figure 6.6</A>
has a pop-up menu, shown in&#160;<A HREF="index.htm#popupfor">Figure 4.2</A>.
<P><A NAME="popupfor">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/popupfor.gif" ALT="popupfor.gif (4744 bytes)" HEIGHT="222" WIDTH="372">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.2:</B> Popup Menu on the Random Variable Formula Element</SPAN><P>
<P>If you select <B>Edit</B>, the window shown
in&#160;<A HREF="index.htm#cpformur">Figure 4.3</A> is displayed.
From this window you select the distribution for the
random variable.
When the formula is evaluated (to set an attribute or
determine transaction routing, for example),
an observation of the random variable is made.
<P><A NAME="cpformur">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/cpformur.gif" ALT="cpformur.gif (2956 bytes)" HEIGHT="160" WIDTH="297">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.3:</B> Control Panel for the Random Variable Formula Element</SPAN><P>
<P>Another important formula element is the model element,
<IMG SRC="images/formulm2.gif" ALT="formulm2.gif (988 bytes)" HEIGHT="26" WIDTH="27">.
Recall the example discussed in the  <A HREF="../chap2/sect9.htm#switch">&#34;Switch Component&#34;</A> .
There, the model in&#160;<A HREF="../chap2/sect9.htm#switchmo">Figure 2.11</A>
routes transactions to the shortest queue.
The control panel on the Switch shown<A NAME="idxqs40010">&#13;</A>in&#160;<A HREF="../chap2/sect9.htm#cpswitch">Figure 2.10</A> has TRUE as a case 
for routing to component Queue 1.
This means that you want the formula associated with this
switch to return TRUE if Queue 1 is shorter than Queue 2.
To accomplish this, you compare the sizes of the
two queues and return TRUE if the size of Queue 1 is less
than the size of Queue 2.
<P><A NAME="formulaq">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/formulaq.gif" ALT="formulaq.gif (1217 bytes)" HEIGHT="46" WIDTH="140">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.4:</B> Formula for Comparing the Size of Two Queues</SPAN><P>
<P><A HREF="index.htm#formulaq">Figure 4.4</A> shows the formula for accomplishing this.
The edit window for the left-hand model element
is shown in&#160;<A HREF="index.htm#cpformum">Figure 4.5</A>.
<P><A NAME="cpformum">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/cpformum.gif" ALT="cpformum.gif (4550 bytes)" HEIGHT="278" WIDTH="317">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.5:</B> The Model Element Edit Window</SPAN><P>
<P>The Model list box contains the simulation components.
When you select one of these components the Query list box
displays <I>query messages</I> for that component.
When the formula is evaluated, the result of the query of
the identified component will be used.
For example, when the formula shown in&#160;<A HREF="index.htm#formulaq">Figure 4.4</A> 
is evaluated, the model
element will query Queue 1 with the message <EM>size</EM>,
which will return the number of elements in its queue.
Similarly, if you edit the model element on the right-hand
side of the <SPAN CLASS="mathfont">&#62;</SPAN> and set it to query size of Queue 2,
the formula will evaluate to TRUE if Queue 1 has
fewer elements than Queue 2.
In this case, the switch will send the transaction to Queue 1.
<P>You should be careful when validating your models that
they are behaving as you want them.
There is not a great amount of error-checking done
when formulas are evaluated, particularly with regard to type,
but every error will not be detected.
For example, a Router may expect a TRUE or FALSE
returned from a formula, but you could enter a valid formula
that evaluates to a number or a string.
The QSIM Application would not detect this type of
error but would function as if a nonzero number were TRUE.
<P>The formula syntax is standard with two exceptions.
First, functions of one argument, such as the trigonometric functions,
are specified in reverse polish style.
Thus, an expression like <SPAN CLASS="mathfont"><I>log</I>(<I>X</I>)</SPAN> would be displayed as in
in&#160;<A HREF="index.htm#formulal">Figure 4.6</A>.
<P><A NAME="formulal">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/formulal.gif" ALT="formulal.gif (1109 bytes)" HEIGHT="52" WIDTH="105">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.6:</B> A Formula for the Log of a Random Variable</SPAN><P>
<P>Functions of two arguments, such as max and min, are specified
between the arguments.
So, an expression like <IMG WIDTH="88" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="images/qs4eq1.gif"
 ALT="max(X,\pi)"> would be displayed as
in&#160;<A HREF="index.htm#formulam">Figure 4.7</A>.
<P><A NAME="formulam">&#13;</A><CENTER>
        <TABLE BORDER="1" CELLPADDING="7" CELLSPACING="0" 
         RULES="GROUPS" FRAME="BOX"
         BGCOLOR="#F0F0F0" BORDERCOLOR="#000000">
        <TR><TD ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#F0F0F0">
<IMG SRC="images/formulam.gif" ALT="formulam.gif (1421 bytes)" HEIGHT="48" WIDTH="223">
</TD></TR></TABLE></CENTER><BR>
<SPAN CLASS="ssften"><B>Figure 4.7:</B> A Formula for the Maximum of a Random Variable and <IMG WIDTH="14" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="images/qs4eq2.gif"
 ALT="\pi"></SPAN><P>
<!--Navigation Panel-->
<TABLE BORDER="0" CELLPADDING="0">
<TR VALIGN="TOP">
  <TD ALIGN="CENTER">
  <A HREF="../index.htm">
  <IMG BORDER="0" SRC="../../common/images/cont1.gif" ALT="Book Contents" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Book Contents</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="../chap3/index.htm"><IMG BORDER="0" SRC="../../common/images/prev1.gif" ALT="Previous" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Previous</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="../chap5/index.htm"><IMG BORDER="0" SRC="../../common/images/next1.gif" ALT="Next" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Next</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="#topofpage">
  <IMG BORDER="0" SRC="../../common/images/top1.gif" ALT="Top" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Top</FONT></A></TD>
</TR>
</TABLE>
<P><!--End of Navigation Panel-->

</BODY>
</HTML>
