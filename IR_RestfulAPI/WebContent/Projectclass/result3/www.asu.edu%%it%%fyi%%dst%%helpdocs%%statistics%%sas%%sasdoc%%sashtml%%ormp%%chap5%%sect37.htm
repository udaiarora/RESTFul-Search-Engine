<HTML>
<HEAD>
<TITLE>Covariance Matrix</TITLE>
<LINK REL="STYLESHEET" TYPE="text/css" HREF="../sas.css">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<A NAME="nlpcm">&#13;</A>
<!--Navigation Panel-->
<TABLE BORDER="0" CELLPADDING="0">
<TR VALIGN="TOP">
  <TD ALIGN="CENTER">
  <A NAME="topofpage" HREF="index.htm">
  <IMG BORDER="0" SRC="../../common/images/cont1.gif" ALT="Chapter Contents" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Chapter Contents</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect36.htm"><IMG BORDER="0" SRC="../../common/images/prev1.gif" ALT="Previous" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Previous</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect38.htm"><IMG BORDER="0" SRC="../../common/images/next1.gif" ALT="Next" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Next</FONT></A></TD>
</TR>
</TABLE>
<TABLE BGCOLOR="#CCCC99" WIDTH="100%" CELLPADDING=4>
<TR>
  <TD VALIGN=MIDDLE CLASS="chaphead"><I><FONT SIZE="2">The NLP Procedure</FONT></I></TD>
</TR>
</TABLE><BR>
<P><!--End of Navigation Panel-->
<H2>Covariance Matrix</H2>
<P><A NAME="idxnlp0504">&#13;</A><A NAME="idxnlp0505">&#13;</A><A NAME="idxnlp0506">&#13;</A><A NAME="idxnlp0507">&#13;</A>The COV= option must be specified to compute an approximate
covariance matrix for the parameter estimates under asymptotic
theory for least-squares, maximum-likelihood, or Bayesian
estimation, with or without corrections for degrees of freedom
as specified by the VARDEF= option.
<P>Two groups of six different forms of covariance matrices
(and therefore approximate standard errors) can be computed
corresponding to the following two situations:
<UL>
<LI> The LSQ statement is specified, which means that
      least-squares estimates are being computed,
      
<DL CLASS="equation"><DD><IMG WIDTH="162" HEIGHT="110"
 SRC="images/nlpeq158.gif"
 ALT="{min } f(x) = \sum_{i=1}^m f^2_i(x) "></DL>
<LI> The MIN or MAX  statement is specified, which means
      that maximum-likelihood or Bayesian estimates are
      being computed,
      
<DL CLASS="equation"><DD><IMG WIDTH="153" HEIGHT="110"
 SRC="images/nlpeq159.gif"
 ALT="{opt } f(x) = \sum_{i=1}^m f_i(x) "></DL>
      where <SPAN CLASS="mathfont"><I>opt</I></SPAN> is either <SPAN CLASS="mathfont"><I>min</I></SPAN> or <SPAN CLASS="mathfont"><I>max</I></SPAN>.
</UL>
In either case, the following matrices are used:
      
<DL CLASS="equation"><DD><IMG WIDTH="94" HEIGHT="76"
 SRC="images/nlpeq160.gif"
 ALT="G = \nabla^2 f(x) "></DL>
      
<DL CLASS="equation"><DD><IMG WIDTH="253" HEIGHT="98"
 SRC="images/nlpeq161.gif"
 ALT="J(f) = (\nabla f_1, ... ,\nabla f_m)
 = (\frac{\partial f_i}{\partial x_j}) "></DL>
      
<DL CLASS="equation"><DD>
<SPAN CLASS="mathfont"><b>JJ</b>(<I>f</I>) = <b>J</b>(<I>f</I>)<sup><I>T</I></sup> <b>J</b>(<I>f</I>)</SPAN>
</DL>
      
<DL CLASS="equation"><DD>
<SPAN CLASS="mathfont"><b>V</b> = <b>J</b>(<I>f</I>)<sup><I>T</I></sup> <I>Diag</I>(<I>f</I><sub><I>i</I></sub><sup>2</sup>) <b>J</b>(<I>f</I>)</SPAN>
</DL>
      
<DL CLASS="equation"><DD><IMG WIDTH="199" HEIGHT="79"
 SRC="images/nlpeq162.gif"
 ALT="W = J(f)^T Diag(f_i^{\dagger}) J(f) "></DL>
      where
      
<DL CLASS="equation"><DD><IMG WIDTH="183" HEIGHT="101"
 SRC="images/nlpeq163.gif"
 ALT="f_i^{\dagger} = \{ 0 & {if f_i=0} \ 1 / f_i & {otherwise}
 . "></DL>
<P>For unconstrained minimization, or when none of the final
parameter estimates is subjected to linear equality or active
inequality constraints, the formulas of the six types of
covariance matrices areas follows.
<DIV ALIGN="CENTER">
<TABLE COLS=4 FRAME=BOX RULES=GROUPS CELLPADDING=5 CELLSPACING=0 BGCOLOR="#F0F0F0" BORDER=1><COLGROUP><COL ALIGN=CENTER><COL ALIGN=CENTER><COLGROUP><COL ALIGN=CENTER><COLGROUP><COL ALIGN=CENTER>
<TBODY>
<TR VALIGN="TOP"><TD BGCOLOR="#BBBBBB"  ALIGN=CENTER NOWRAP COLSPAN=2><B>
                      <FONT COLOR="#003399" FACE="Verdana, Helvetica, Helv"><B>COV</B></FONT></B>
                      </TD>
                     <TD BGCOLOR="#BBBBBB"  ALIGN=CENTER NOWRAP><B>
                      <FONT COLOR="#003399" FACE="Verdana, Helvetica, Helv"><B>MIN or MAX  Statement</B></FONT></B>
                      </TD>
                     <TD BGCOLOR="#BBBBBB"  ALIGN=CENTER NOWRAP><B>
                      <FONT COLOR="#003399" FACE="Verdana, Helvetica, Helv"><B>LSQ Statement</B></FONT></B>
                      </TD>
                     </TR><TBODY>
<TR VALIGN="TOP"><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>1</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>M</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[ _NOBS_/<I>d</I>] <I>G<SUp>-1</SUp></I> <I>JJ</I>(<I>f</I>) <I>G<SUp>-1</SUp></I></SPAN></TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[ _NOBS_/<I>d</I>] <I>G<SUp>-1</SUp></I> <I>V G<SUp>-1</SUp></I></SPAN></TD></TR>
<TR VALIGN="TOP"><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>2</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>H</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[ _NOBS_/<I>d</I>] <I>G<SUp>-1</SUp></I></SPAN></TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><IMG WIDTH="55" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq164.gif"
 ALT="\sigma^2 G^{-1}"></TD></TR>
<TR VALIGN="TOP"><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>3</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>J</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[1/<I>d</I>] <I>W<SUp>-1</SUp></I></SPAN></TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><IMG WIDTH="90" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="images/nlpeq165.gif"
 ALT="\sigma^2 JJ(f)^{-1}"></TD></TR>
<TR VALIGN="TOP"><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>4</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>B</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[1/<I>d</I>] <I>G<SUp>-1</SUp></I> <I>W G<SUp>-1</SUp></I></SPAN></TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><IMG WIDTH="137" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="images/nlpeq166.gif"
 ALT="\sigma^2 G^{-1} JJ(f) G^{-1}"></TD></TR>
<TR VALIGN="TOP"><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>5</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>E</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[ _NOBS_/<I>d</I>] <I>JJ</I>(<I>f</I>)<sup>-1</sup></SPAN></TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[1/<I>d</I>] <I>V<SUp>-1</SUp></I></SPAN></TD></TR>
<TR VALIGN="TOP"><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>6</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP>U</TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[ _NOBS_/<I>d</I>] <I>W<SUp>-1</SUp></I> <I>JJ</I>(<I>f</I>) <I>W<SUp>-1</SUp></I></SPAN></TD><TD BGCOLOR="#DDDDDD" ALIGN=CENTER NOWRAP><SPAN CLASS="mathfont">[ _NOBS_/<I>d</I>] <I>JJ</I>(<I>f</I>)<sup>-1</sup> <I>V JJ</I>(<I>f</I>)<sup>-1</sup></SPAN></TD></TR></TBODY>
</TABLE></DIV>The value of <SPAN CLASS="mathfont"><I>d</I></SPAN> depends on the VARDEF= option and on the value
of the _NOBS_ variable:

<DL CLASS="equation"><DD><IMG WIDTH="407" HEIGHT="101"
 SRC="images/nlpeq167.gif"
 ALT="d = \{ \max(1,{\_NOBS\_} - {\_DF\_}) & 
 {for VARDEF= DF} \ {\_NOBS\_} & {for VARDEF= N}
 ."></DL>
where _DF_ is either set in the program statements or set
by default to <SPAN CLASS="mathfont"><I>n</I></SPAN> (the number of parameters) and _NOBS_ is
either set in the program statements or set by default to
<SPAN CLASS="mathfont">nobs *  mfun</SPAN>; nobs is 
the number of observations in the data
set and mfun is the number of functions listed in the LSQ,
MIN, or MAX  statement.
<P>The value <IMG WIDTH="22" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq13.gif"
 ALT="\sigma^2"> depends on the specifications of the SIGSQ=
options and on the value of <SPAN CLASS="mathfont"><I>d</I></SPAN>:

<DL CLASS="equation"><DD><IMG WIDTH="404" HEIGHT="101"
 SRC="images/nlpeq168.gif"
 ALT="\sigma^2 = \{ sq * \_NOBS\_ / d & {if SIGSQ=sq\space is specified} \ 2 * f(x^*) / d & {if SIGSQ= is not specified}
 ."></DL>
where <SPAN CLASS="mathfont"><I>f</I>(<I>x<SUP>*</SUP></I>)</SPAN> is the value of the objective function at the
optimal parameter estimates <SPAN CLASS="mathfont"><I>x<SUP>*</SUP></I></SPAN>.
<P>The two groups of formulas distinguish between two situations:
<UL>
<LI> For least-squares estimates, the error
variance can be estimated from the objective function value and
is used in three of the six different forms of covariance
matrices. If you have an independent
estimate of the error variance, you can specify it with the
SIGSQ= option.
<LI> For maximum-likelihood or Bayesian estimates,
the objective function should be the logarithm of the likelihood
or of the posterior density when using the MAX statement.
</UL>
<P>For minimization, the inversion of the matrices in these formulas
is done so that negative eigenvalues are considered zero,
resulting always in a positive semidefinite covariance matrix.
<P>In small samples, estimates of the covariance matrix based on
asymptotic theory are often too small and should be used with
caution.
<P>If the final parameter estimates are subjected to <SPAN CLASS="mathfont"><I>n</I><SUB><I>act</I></SUB> &#62; 0</SPAN>
linear equality or active linear inequality constraints, the
formulas of the covariance matrices are modified
similar to Gallant (1987) and Cramer (1986, p. 38) and
additionally generalized for applications with singular
matrices. In the constrained case, the value of <SPAN CLASS="mathfont"><I>d</I></SPAN> used in
the scalar factor <IMG WIDTH="22" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq13.gif"
 ALT="\sigma^2"> is defined by

<DL CLASS="equation"><DD><IMG WIDTH="460" HEIGHT="101"
 SRC="images/nlpeq169.gif"
 ALT="d = \{ \max(1,{\_NOBS\_} - {\_DF\_} + n_{act}) & 
{for VARDEF= DF} \ {\_NOBS\_} & {for VARDEF= N}
 ."></DL>
where <SPAN CLASS="mathfont"><I>n</I><SUB><I>act</I></SUB></SPAN> is the number of active constraints, and
_NOBS_ is set as in the unconstrained case.
<P><A NAME="idxnlp0508">&#13;</A><A NAME="idxnlp0509">&#13;</A><A NAME="idxnlp0510">&#13;</A>For minimization, the covariance matrix should be positive
definite; for maximization it should be negative definite.
There are several options available to check for a rank     
deficiency of the covariance matrix:
<UL>
<LI> The ASINGULAR=, MSINGULAR=, and VSINGULAR= options can
      be used to set three singularity criteria for the inversion
      of the matrix <SPAN CLASS="mathfont"><I>A</I></SPAN> needed to compute the covariance matrix,
      when <SPAN CLASS="mathfont"><I>A</I></SPAN> is either the Hessian
      or one of the crossproduct Jacobian matrices.
      The singularity criterion used for the inversion is
      
<DL CLASS="equation"><DD><IMG WIDTH="544" HEIGHT="75"
 SRC="images/nlpeq170.gif"
 ALT="| d_{j,j}| \le \max ({ASING}, 
 {VSING} * | A_{j,j}|,
 {MSING} * max(| A_{1,1}|, ... ,| A_{n,n}|)) "></DL>
      where <SPAN CLASS="mathfont"><I>d</I><SUB><I>j</I>,<I>j</I></SUB></SPAN> is the diagonal pivot of the matrix <SPAN CLASS="mathfont"><I>A</I></SPAN>,
      and ASING, VSING and MSING are the specified values of
      the ASINGULAR=, VSINGULAR=, and MSINGULAR= options. The
      default values are
<UL>
<LI> ASING: the square root of the smallest positive double
      precision value
<LI> MSING: <SPAN CLASS="mathfont">1<I>e</I>-12</SPAN> if the SINGULAR= option is not specified
      and <IMG WIDTH="265" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="images/nlpeq171.gif"
 ALT="\max (10. * \epsilon,{1e-4}*{SINGULAR})"> otherwise,
      where <IMG WIDTH="11" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq24.gif"
 ALT="\epsilon"> is the machine precision
<LI> VSING: <SPAN CLASS="mathfont">1<I>e</I>-8</SPAN> if the SINGULAR= option is not specified
      and the value of SINGULAR otherwise
</UL>
      <B>Note</B>: In many cases, a normalized matrix <SPAN CLASS="mathfont"><I>D<SUP>-1</SUP></I><I>AD<SUP>-1</SUP></I></SPAN>
      is decomposed and the singularity criteria are modified
      correspondingly.
<LI> If the matrix <SPAN CLASS="mathfont"><I>A</I></SPAN> is found singular in the first step,
      a generalized inverse is computed. Depending on the G4=
      option, either a generalized inverse satisfying all four
      Moore-Penrose conditions is computed or a generalized
      inverse satisfying only two Moore-Penrose conditions in
      general. If the number of parameters <SPAN CLASS="mathfont"><I>n</I></SPAN> of the
      application is less than or equal to G4=<SPAN CLASS="mathfont"><I>i</I></SPAN>, a G4 inverse
      is computed; otherwise only a G2 inverse is computed.
      The G4 inverse is computed by (the computationally very
      expensive but numerically stable) eigenvalue decomposition,
      the G2 inverse is computed by Gauss transformation.
      The G4 inverse is computed using the eigenvalue
      decomposition <IMG WIDTH="92" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq172.gif"
 ALT="A = Z \Lambda Z^T">, where <SPAN CLASS="mathfont"><I>Z</I></SPAN> is the
      orthogonal matrix of eigenvectors and <IMG WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq173.gif"
 ALT="\Lambda"> is
      the diagonal matrix of eigenvalues,
      <IMG WIDTH="159" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="images/nlpeq174.gif"
 ALT=" \Lambda = diag(\lambda_1,...,\lambda_n) ">.      If the PEIGVAL option is specified, the eigenvalues
      <IMG WIDTH="20" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="images/nlpeq80.gif"
 ALT="\lambda_i"> are displayed. The G4 inverse of <SPAN CLASS="mathfont"><I>A</I></SPAN> is set to
     
<DL CLASS="equation"><DD><IMG WIDTH="109" HEIGHT="72"
 SRC="images/nlpeq175.gif"
 ALT="A^- = Z \Lambda^- Z^T
 "></DL>
      where the diagonal matrix
      <IMG WIDTH="177" HEIGHT="37" ALIGN="MIDDLE" BORDER="0"
 SRC="images/nlpeq176.gif"
 ALT="\Lambda^- = diag(\lambda^-_1,...,\lambda^-_n)">      is defined using the COVSING= option
      
<DL CLASS="equation"><DD><IMG WIDTH="279" HEIGHT="101"
 SRC="images/nlpeq177.gif"
 ALT="\lambda^-_i = \{ 1 / \lambda_i & {if |\lambda_i| \gt COVSING} \ 0 & {if |\lambda_i| \le COVSING}
 . "></DL>
      If the COVSING= option is not specified, the <SPAN CLASS="mathfont"><I>nr</I></SPAN>
      smallest eigenvalues are set to zero, where <SPAN CLASS="mathfont"><I>nr</I></SPAN> is
      the number of rank deficiencies found in the first step.
</UL>
<P>For optimization techniques that do not use second-order
derivatives, the covariance matrix is usually computed
using finite difference approximations of the derivatives.
By specifying TECH= NONE, any of the covariance matrices
can be computed using analytical derivatives. The covariance
matrix specified by the COV= option can be displayed 
(using the PCOV option)
and is written to the OUTEST= or OUTVAR= data set.
<P>
<!--Navigation Panel-->
<TABLE BORDER="0" CELLPADDING="0">
<TR VALIGN="TOP">
  <TD ALIGN="CENTER">
  <A HREF="index.htm">
  <IMG BORDER="0" SRC="../../common/images/cont1.gif" ALT="Chapter Contents" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Chapter Contents</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect36.htm"><IMG BORDER="0" SRC="../../common/images/prev1.gif" ALT="Previous" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Previous</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect38.htm"><IMG BORDER="0" SRC="../../common/images/next1.gif" ALT="Next" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Next</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="#topofpage">
  <IMG BORDER="0" SRC="../../common/images/top1.gif" ALT="Top" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Top</FONT></A></TD>
</TR>
</TABLE>
<P><!--End of Navigation Panel-->
<P><FONT SIZE="1"><A HREF="../../common/images/copyrite.htm">Copyright &copy; 1999 by SAS Institute Inc., Cary, NC, USA. All rights reserved.</A></FONT>
</BODY>
</HTML>
