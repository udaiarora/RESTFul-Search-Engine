<HTML>
<HEAD>
<TITLE>Testing the Gradient Specification</TITLE>
<LINK REL="STYLESHEET" TYPE="text/css" HREF="../sas.css">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<A NAME="nlpttgs">&#13;</A>
<!--Navigation Panel-->
<TABLE BORDER="0" CELLPADDING="0">
<TR VALIGN="TOP">
  <TD ALIGN="CENTER">
  <A NAME="topofpage" HREF="index.htm">
  <IMG BORDER="0" SRC="../../common/images/cont1.gif" ALT="Chapter Contents" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Chapter Contents</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect29.htm"><IMG BORDER="0" SRC="../../common/images/prev1.gif" ALT="Previous" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Previous</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect31.htm"><IMG BORDER="0" SRC="../../common/images/next1.gif" ALT="Next" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Next</FONT></A></TD>
</TR>
</TABLE>
<TABLE BGCOLOR="#CCCC99" WIDTH="100%" CELLPADDING=4>
<TR>
  <TD VALIGN=MIDDLE CLASS="chaphead"><I><FONT SIZE="2">The NLP Procedure</FONT></I></TD>
</TR>
</TABLE><BR>
<P><!--End of Navigation Panel-->
<H2>Testing the Gradient Specification</H2>
<A NAME="idxnlp0470">&#13;</A><A NAME="idxnlp0471">&#13;</A><A NAME="idxnlp0472">&#13;</A>There are three main ways to check the correctness of
derivative specifications.
<UL>
<LI> Specify the FD[=] or FDHESSIAN[=] option in the PROC NLP
      statement to compute finite difference approximations of
      first- and second-order derivatives. In many applications,
      the finite difference approximations are computed with high
      precision and do not differ too much from the derivatives
      that are computed by specified formulas.
<LI> Specify the GRADCHECK[=DETAIL] or GC[=DETAIL] option in
      the PROC NLP statement to compute and display a test vector
      and a test matrix of the gradient values at the start
      point <SPAN CLASS="mathfont"><I>x<SUP>(0)</SUP></I></SPAN> by the method of Wolfe (1982). If you do
      not specify the GRADCHECK option, a fast derivative test
      identical to the GRADCHECK= FAST specification is done
      by default.
<LI> If the default analytical derivative compiler is used or
      if derivatives are specified using the GRADIENT or JACOBIAN
      statement, the gradient or Jacobian computed at the initial
      point <SPAN CLASS="mathfont"><I>x<SUP>(0)</SUP></I></SPAN> is tested by default using finite difference
      approximations. In some examples, the relative test can show
      significant differences between the two forms of derivatives
      and result in a warning message indicating that the specified
      derivatives could be wrong, even if they are correct. This
      happens especially in cases where the magnitude of the gradient
      at the starting point <SPAN CLASS="mathfont"><I>x<SUP>(0)</SUP></I></SPAN> is small.
</UL>
<P>The algorithm of Wolfe (1982) is used to check whether the gradient
<SPAN CLASS="mathfont"><I>g</I>(<I>x</I>)</SPAN> specified by a GRADIENT (or indirectly by a JACOBIAN)
statement is appropriate for the objective function <SPAN CLASS="mathfont"><I>f</I>(<I>x</I>)</SPAN>
specified by the program statements.
<P>Using function and gradient evaluations in the neighborhood of
the starting point <SPAN CLASS="mathfont"><I>x<SUP>(0)</SUP></I></SPAN>, second derivatives are approximated
by finite difference formulas. Forward differences of gradient
values are used to approximate the Hessian element <SPAN CLASS="mathfont"><I>G</I><SUB><I>jk</I></SUB></SPAN>,

<DL CLASS="equation"><DD><IMG WIDTH="261" HEIGHT="94"
 SRC="images/nlpeq120.gif"
 ALT="G_{jk} \approx H_{jk} = {g_j(x + \delta e_k) - g_j(x) \over \delta} "></DL>
where <IMG WIDTH="12" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq121.gif"
 ALT="\delta"> is a small step size and <SPAN CLASS="mathfont"><I>e</I><sub><I>k</I></sub> = (0, ... ,0,1,0, ... ,0)<sup><I>T</I></sup></SPAN>
is the unit vector along the <SPAN CLASS="mathfont"><I>k</I></SPAN>th coordinate axis. The test vector <SPAN CLASS="mathfont"><I>S</I></SPAN>,
with

<DL CLASS="equation"><DD><IMG WIDTH="326" HEIGHT="94"
 SRC="images/nlpeq122.gif"
 ALT="s_j = H_{jj} - {2 \over \delta} \{{f(x + \delta e_j) - f(x)
 \over \delta} - g_j(x)\} "></DL>
contains the differences between two sets of finite difference
approximations for the diagonal elements of the Hessian matrix

<DL CLASS="equation"><DD><IMG WIDTH="298" HEIGHT="80"
 SRC="images/nlpeq123.gif"
 ALT="G_{jj} = \partial^2 f(x^{(0)}) / \partial x^2_j  ,  j=1, ... ,n "></DL>
The test matrix <IMG WIDTH="35" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="images/nlpeq124.gif"
 ALT="\Delta H"> contains the absolute differences
of symmetric elements in the approximate Hessian
<SPAN CLASS="mathfont">|<I>H</I><SUB><I>jk</I></SUB> - <I>H</I><SUB><I>kj</I></SUB>|</SPAN>, <SPAN CLASS="mathfont"><I>j</I>,<I>k</I> = 1, ... ,<I>n</I></SPAN>, generated by forward
differences of the gradient elements.
<P>If the specification of the first derivatives is correct, the
elements of the test vector and test matrix should be relatively
small. The location of large elements in the test matrix points
to erroneous coordinates in the gradient specification.
For very large optimization problems, this algorithm can be
too expensive in terms of computer time and memory.
<P>
<!--Navigation Panel-->
<TABLE BORDER="0" CELLPADDING="0">
<TR VALIGN="TOP">
  <TD ALIGN="CENTER">
  <A HREF="index.htm">
  <IMG BORDER="0" SRC="../../common/images/cont1.gif" ALT="Chapter Contents" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Chapter Contents</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect29.htm"><IMG BORDER="0" SRC="../../common/images/prev1.gif" ALT="Previous" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Previous</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="sect31.htm"><IMG BORDER="0" SRC="../../common/images/next1.gif" ALT="Next" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Next</FONT></A></TD>
  <TD ALIGN=CENTER>
  <A HREF="#topofpage">
  <IMG BORDER="0" SRC="../../common/images/top1.gif" ALT="Top" WIDTH="99" HEIGHT="16"><BR><FONT SIZE="-2">Top</FONT></A></TD>
</TR>
</TABLE>
<P><!--End of Navigation Panel-->
<P><FONT SIZE="1"><A HREF="../../common/images/copyrite.htm">Copyright &copy; 1999 by SAS Institute Inc., Cary, NC, USA. All rights reserved.</A></FONT>
</BODY>
</HTML>
